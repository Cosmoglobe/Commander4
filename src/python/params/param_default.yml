MPI_config:
  ntask_tod: 64
  ntask_compsep: 8
nthreads_compsep: 4
betzy_mode: false

CG_max_iter: 2000
CG_err_tol: 0.000001 # 1e-6  # V/uK_RJ

niter_gibbs: 5

nside: 512

noise_fknee: 0.1
noise_alpha: -0.9
initial_g0: 50.0e-9

sample_corr_noise_from_iter_num: 3
sample_gain_from_iter_num: 2

make_plots: True
output_stats: True

galactic_mask: True
sample_corr_noise: True
pixel_compsep_sampling: true

output_paths:
  plots: "../commander4_plots/"
  stats: "../commander4_stats/"

logging:
  console:
    level: 'info'
  file:
    level: 'info'
    filename: 'output.log'


components:
  CMB:
    enabled: true
    component_class: "CMB"
    params:
      longname: "CMB"
      shortname: "cmb"
      lmax: "full"
      smoothing_scale: 0

  ThermalDust:
    enabled: true
    component_class: "ThermalDust"
    params:
      longname: "Thermal Dust"
      shortname: "dust"
      beta: 1.56
      T: 20
      nu0: 545
      lmax: "full"
      smoothing_scale: 0

  Synchrotron:
    enabled: true
    component_class: "Synchrotron"
    params:
      longname: "Synchrotron"
      shortname: "sync"
      beta: -3.1
      nu0: 30
      lmax: "full"
      smoothing_scale: 0

  FreeFree:
    enabled: true
    component_class: "FreeFree"
    params:
      longname: "Free-Free"
      shortname: "ff"
      T: 7000
      nu0: 40
      lmax: "full"
      smoothing_scale: 0
  
  SpinningDust:
    enabled: true
    component_class: "SpinningDust"
    params:
      longname: "SpinningDust"
      shortname: "sdust"
      nu_peak: 25.3  # Ghz
      nu_0: 22.0  # Ghz
      lmax: "full"
      smoothing_scale: 0


compsep:
  dense_matrix_debug_mode: false  # Solve system first with dense matrix math, for debugging CG. Very slow for nside>32.
  preconditioner: NoPreconditioner #JointPreconditioner #NoiseOnlyPreconditioner #FullPreconditioner #MixingMatrixPreconditioner #BeamOnlyPreconditioner #


CompSep_bands:
  Planck30GHz:
    enabled: true
    get_from: "PlanckLFI"
  Planck44GHz:
    enabled: true
    get_from: "PlanckLFI"
  Planck70GHz:
    enabled: true
    get_from: "PlanckLFI"

  Haslam408MHz:
    enabled: true
    get_from: "file"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_n0512_60arcmin_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_rms_n0512_60arcmin_uK_1pct_0.8K.fits"
    fwhm: 60 # [arcmin]
    freq: 0.408 # [GHz]
  WMAPKa:
    enabled: true
    get_from: "file"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_N_v4.fits"
    fwhm: 40 # [arcmin]
    freq: 33.0 # [GHz]
  WMAPQ1:
    enabled: true
    get_from: "file"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_N_v4.fits"
    fwhm: 8.3 # [arcmin]
    freq: 40.6 # [GHz]
  WMAPV1:
    enabled: true
    get_from: "file"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_N_v4.fits"
    fwhm: 14.0 # [arcmin]
    freq: 60.8 # [GHz]

  Planck857GHz:
    enabled: true
    get_from: "file"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_map_n1024_10arcmin_QUADCOR_ZODICOR_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_rms_n1024_10arcmin_uK_hrscaled_true.fits"
    fwhm: 10 # [arcmin]
    freq: 857.0 # [GHz]


experiments:
  PlanckLFI:
    enabled: true
    is_sim: false
    data_type: "TOD"
    data_path: "/mn/stornext/d16/cmbco/bp/mathew/test/"
    num_scans: 45860
    bands:
      Planck30GHz:
        num_MPI_tasks: 12
        detector_id: 0
        freq_identifier: 30
        enabled: true
        eval_nside: 512
        data_nside: 512
        fwhm: 32.4 # [arcmin]
        freq: 28.4 # [GHz]
        fsamp: 32.5079365079365 # [Hz]
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        rel_gain_est: 26.733e-9  # 74
        detectors:
          27M:
            name: "27M"
            rel_gain_est: 26.733e-9  # 74
          27S:
            name: "27S"
            rel_gain_est: 26.733e-9  # 74
      Planck44GHz:
        num_MPI_tasks: 20
        freq_identifier: 44
        eval_nside: 512
        data_nside: 512
        enabled: true
        fwhm: 27.1 # [arcmin]
        freq: 44.1 # [GHz]
        fsamp: 46.5454545454545
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_044_res_v5.fits"
        rel_gain_est: -42.467e-9  # 4.8
        detectors:
          24M:
            name: "24M"
            rel_gain_est: -42.467e-9  # 4.8
          24S:
            name: "24S"
            rel_gain_est: -42.467e-9  # 4.8
      Planck70GHz:
        num_MPI_tasks: 32
        freq_identifier: 70
        eval_nside: 512
        data_nside: 1024
        enabled: true
        fwhm: 13.3 # [arcmin]
        freq: 70.1 # [GHz]
        fsamp: 78.7692307692308
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_070_res_v5.fits"
        rel_gain_est: 15.733e-9  # 63
        detectors:
          18M:
            name: "18M"
            rel_gain_est: 15.733e-9  # 63
          18S:
            name: "18S"
            rel_gain_est: 15.733e-9  # 63