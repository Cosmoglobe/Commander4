CG_float_precision: "single"
general:
  MPI_config:
    ntask_tod: 192
    ntask_compsep_I: 11
    ntask_compsep_QU: 11
  nthreads_tod: 2
  nthreads_compsep: 8

  niter_gibbs: 30

  nside: 512
  
  CG_max_iter: 100
  CG_max_iter_pol: 100
  CG_err_tol: 1.0e-100
  CG_float_precision: "single"
  CG_real_alm_mode: False
  
  noise_fknee: 0.005
  noise_alpha: -0.8

  sample_corr_noise: True
  sample_corr_noise_from_iter_num: 10
  sample_abs_gain: True
  sample_abs_gain_from_iter_num: 2
  sample_rel_gain: True
  sample_rel_gain_from_iter_num: 6
  sample_temporal_gain: True
  sample_temporal_gain_from_iter_num: 12

  make_plots: True
  output_stats: False

  galactic_mask: False
  sample_corr_noise: True
  pixel_compsep_sampling: True
  smooth_to_common_res: True

  output_paths:
    chains: "/mn/stornext/d23/cmbco/jonas/c4_testing/cmdr4_chains/litebird/inplacesim/"
    plots: "/mn/stornext/d23/cmbco/jonas/c4_testing/cmdr4_plots/litebird/inplacesim/"
    stats: "/mn/stornext/d23/cmbco/jonas/c4_testing/cmdr4_stats/litebird/inplacesim/"

  logging:
    console:
      level: 'info'
    file:
      level: 'info'
      filename: '/mn/stornext/d23/cmbco/jonas/c4_testing/cmdr4_logs/litebird/inplacesim.log'


components:
  CMB:
    enabled: true
    component_class: "CMB"
    params:
      polarizations: [True, False, False] #I Q U 
      longname: "CMB"
      shortname: "cmb"
      smoothing_prior_FWHM: 30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+7 #1.0  # uK_RJ^2
      lmax: 1024
      smoothing_scale: 0
      spatially_varying_MM: False

  CMB_pol:
    enabled: true
    component_class: "CMB"
    params:
      polarizations: [False, True, True] #I Q U 
      longname: "CMB"
      shortname: "cmb"
      smoothing_prior_FWHM: 30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+7 #1.0  # uK_RJ^2
      lmax: 1024
      smoothing_scale: 0
      spatially_varying_MM: False

  ThermalDust:
    enabled: true
    component_class: "ThermalDust"
    params:
      polarizations: [True, True, True] #I Q U 
      longname: "Thermal Dust"
      shortname: "dust"
      smoothing_prior_FWHM: 0.0 #5.0 # 10.0 # arcmin
      smoothing_prior_amplitude: 1.0e+7  # uK_RJ^2
      beta: 1.56
      T: 20
      nu0: 545
      lmax: 1024
      smoothing_scale: 0 # 5.0
      spatially_varying_MM: False

  Synchrotron:
    enabled: true
    component_class: "Synchrotron"
    params:
      polarizations: [True, True, True] #I Q U 
      longname: "Synchrotron"
      shortname: "sync"
      smoothing_prior_FWHM: 0.0 #60.0 # arcmin
      smoothing_prior_amplitude: 1.0e+4  # uK_RJ^2
      beta: -3.1
      nu0: 30
      lmax: 1024
      smoothing_scale: 0 # 60.0
      spatially_varying_MM: False

  FreeFree:
    enabled: true
    component_class: "FreeFree"
    params:
      polarizations: [True, False, False] #I Q U 
      longname: "Free-Free"
      shortname: "ff"
      smoothing_prior_FWHM: 0.0 #30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+10  # uK_RJ^2
      T: 7000
      nu0: 0.408 #40
      lmax: 1024
      smoothing_scale: 0 # 30.0
      spatially_varying_MM: False

compsep:
  dense_matrix_debug_mode: false  # Solve system first with dense matrix math, for debugging CG. Very slow for nside>32.
  preconditioner: JointPreconditioner #NoPreconditioner #NoiseOnlyPreconditioner #FullPreconditioner #MixingMatrixPreconditioner #BeamOnlyPreconditioner #


CompSep_bands:
  ### TOD DATA ###
  LiteBIRD40GHz:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]
  LiteBIRD50GHz:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]
  LiteBIRD100GHzM:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]
  LiteBIRD140GHzM:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]
  LiteBIRD195GHzH:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]
  LiteBIRD337GHz:
    enabled: true
    get_from: "LiteBIRD"
    polarizations: [True, True, True]


  ### TOTAL INTENSITY MAPS ###
  Haslam408MHz:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 512
    file_convention: "Haslam"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_n0512_60arcmin_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_rms_n0512_60arcmin_uK_1pct_0.8K.fits"
    fwhm: 60.0  # [arcmin]
    freq: 0.408 # [GHz]
    polarizations: [True, True, True]

  WMAPKa:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_N_v4.fits"
    fwhm: 39.6 # [arcmin]
    freq: 33.0 # [GHz]
    polarizations: [True, True, True]

  WMAPQ1:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_N_v4.fits"
    fwhm: 30.6 # [arcmin]
    freq: 40.6 # [GHz]
    polarizations: [True, True, True]

  WMAPV1:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_N_v4.fits"
    fwhm: 21.0 # [arcmin]
    freq: 60.8 # [GHz]
    polarizations: [True, True, True]

  Planck857GHz:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 1024
    file_convention: "HFI"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_map_n1024_10arcmin_QUADCOR_ZODICOR_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_rms_n1024_10arcmin_uK_hrscaled_true.fits"
    fwhm: 10 # [arcmin]
    freq: 857.0 # [GHz]
    polarizations: [True, False, False]

  ### POLARIZATION MAPS ###
  Planck353GHz:
    enabled: true
    get_from: "file"
    eval_nside: 512
    data_nside: 1024
    file_convention: "HFI"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_353_map_n1024_uK_udgrade.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_353_rms_n1024_hrscaled_uK_udgrade.fits"
    fwhm: 4.86 # [arcmin]
    freq: 353.0 # [GHz]
    polarizations: [False, True, True]


experiments:
  LiteBIRD:
    enabled: true
    is_sim: false
    pix_is_compressed: true
    psi_is_compressed: true
    data_type: "TOD"
    experiment_id: "litebird_sim"  # Decides expected data format, what TOD reader is used, etc.
    # bad_PIDs_path: "/mn/stornext/d23/cmbco/jonas/c4_testing/Commander4/badPIDs.npy"
    Fourier_times_path: "/mn/stornext/d23/cmbco/jonas/c4_testing/analysis/FFT_times_0_399999.npy"
    num_scans: 9142

    replace_tod_with_sim: true

    bands:
      LiteBIRD40GHz:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 40
        eval_nside: 512
        data_nside: 512
        fwhm: 70.5 # [arcmin]
        freq: 40.0 # [GHz]
        fsamp: 50.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_040_L1/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_040_L1.txt"
        lb_det_identifier: "L1"
        detectors:
          000_003_005_QB_040_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          000_003_005_QB_040_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          000_004_003_UA_040_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          000_004_003_UA_040_T:
            gain_est: 1.0
            bandpass_shift: 0.0
      LiteBIRD50GHz:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 50
        eval_nside: 512
        data_nside: 512
        fwhm: 58.5 # [arcmin]
        freq: 50.0 # [GHz]
        fsamp: 50.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_050_L2/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_050_L2.txt"
        lb_det_identifier: "L2"
        detectors:
          000_000_000_QA_050_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          000_000_000_QA_050_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          000_007_008_UB_050_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          000_007_008_UB_050_T:
            gain_est: 1.0
            bandpass_shift: 0.0
      LiteBIRD100GHzM:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 100
        eval_nside: 512
        data_nside: 512
        fwhm: 37.8 # [arcmin]
        freq: 100.0 # [GHz]
        fsamp: 50.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_100_M1/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_100_M1.txt"
        lb_det_identifier: "M1"
        detectors:
          001_002_002_60A_100_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          001_002_002_60A_100_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          001_004_031_15B_100_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          001_004_031_15B_100_T:
            gain_est: 1.0
            bandpass_shift: 0.0
      LiteBIRD140GHzM:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 140
        eval_nside: 512
        data_nside: 512
        fwhm: 30.8 # [arcmin]
        freq: 140.0 # [GHz]
        fsamp: 5.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_140_M1/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_140_M1.txt"
        lb_det_identifier: "M1"
        detectors:
          001_002_031_15B_140_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          001_002_031_15B_140_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          001_004_047_45A_140_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          001_004_047_45A_140_T:
            gain_est: 1.0
            bandpass_shift: 0.0
      LiteBIRD195GHzH:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 195
        eval_nside: 512
        data_nside: 1024
        fwhm: 28.6 # [arcmin]
        freq: 195.0 # [GHz]
        fsamp: 50.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_195_H1/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_195_H1.txt"
        lb_det_identifier: "H1"
        detectors:
          002_000_000_Q_195_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          002_000_000_Q_195_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          002_000_076_U_195_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          002_000_076_U_195_T:
            gain_est: 1.0
            bandpass_shift: 0.0
      LiteBIRD337GHz:
        enabled: true
        num_MPI_tasks: 32
        detector_id: 0
        freq_identifier: 337
        eval_nside: 512
        data_nside: 1024
        fwhm: 20.9 # [arcmin]
        freq: 337.0 # [GHz]
        fsamp: 50.0 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/TODS_eirik_cmb_fg_wn_ncorr30_dipol_v5/LB_337_H2/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/litebird/TOD_analysis/data_LB/filelist_LB_337_H2.txt"
        lb_det_identifier: "H2"
        detectors:
          002_001_050_U_337_B:
            gain_est: 1.0
            bandpass_shift: 0.0  # Ghz
          002_001_050_U_337_T:
            gain_est: 1.0
            bandpass_shift: 0.0
          002_001_126_Q_337_B:
            gain_est: 1.0
            bandpass_shift: 0.0
          002_001_126_Q_337_T:
            gain_est: 1.0
            bandpass_shift: 0.0