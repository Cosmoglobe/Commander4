general:
  MPI_config:
    ntask_tod: 128
    ntask_compsep_I: 1 #8
    ntask_compsep_QU: 1 #8
  nthreads_tod: 1
  nthreads_compsep: 2
  betzy_mode: false

  CG_max_iter: 100
  CG_max_iter_pol: 100
  CG_err_tol: 1.0e-100
  CG_float_precision: "single"
  CG_real_alm_mode: False

  CG_mapmaker:
    maxiter: 2
    err_tol: 1.0e-20

  niter_gibbs: 10

  nside: 256

  noise_fknee: 0.1
  noise_alpha: -0.9
  
  sample_corr_noise: True
  sample_corr_noise_from_iter_num: 8
  sample_abs_gain: True
  sample_abs_gain_from_iter_num: 2
  sample_rel_gain: True
  sample_rel_gain_from_iter_num: 4
  sample_temporal_gain: True
  sample_temporal_gain_from_iter_num: 4

  make_plots: True
  output_stats: False

  galactic_mask: True
  pixel_compsep_sampling: False

  output_paths:
    plots: "/mn/stornext/u3/leoab/com4_plots/Planck_WMAP_TOD_CG_new"
    stats: "/mn/stornext/u3/leoab/com4_stats"
    chains: "/mn/stornext/u3/leoab/com4_chains"

  logging:
    console:
      level: 'info'
    file:
      level: 'info'
      filename: '/mn/stornext/u3/leoab/com4_logs/output_Planck+WMAP_mapsonly_CG.log'

components:
  CMB:
    enabled: true
    component_class: "CMB"
    params:
      polarizations: [True, False, False] #I Q U 
      longname: "CMB"
      shortname: "cmb"
      smoothing_prior_FWHM: 30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+7 #1.0  # uK_RJ^2
      lmax: 1024
      smoothing_scale: 0
      spatially_varying_MM: False

  CMB_pol:
    enabled: true
    component_class: "CMB"
    params:
      polarizations: [False, True, True] #I Q U 
      longname: "CMB"
      shortname: "cmb"
      smoothing_prior_FWHM: 30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+7 # uK_RJ^2
      lmax: 512
      smoothing_scale: 0.0
      spatially_varying_MM: False

  ThermalDust:
    enabled: true
    component_class: "ThermalDust"
    params:
      polarizations: [True, True, True] #[True, True, True]
      longname: "Thermal-Dust"
      shortname: "dust"
      smoothing_prior_FWHM: 5.0 # 10.0 # arcmin
      smoothing_prior_amplitude: 2.0e-3  # uK_RJ^2
      beta: 1.56
      T: 20
      nu0: 545
      lmax: 1024
      smoothing_scale: 0.0
      spatially_varying_MM: False

  Synchrotron:
    enabled: true
    component_class: "Synchrotron"
    params:
      polarizations: [True, False, False]
      longname: "Synchrotron"
      shortname: "sync"
      smoothing_prior_FWHM: 60.0 # arcmin
      smoothing_prior_amplitude: 2.0e-2  # uK_RJ^2
      beta: -3.1
      nu0: 30
      lmax: 512
      smoothing_scale: 0.0
      spatially_varying_MM: True

  FreeFree:
    enabled: true
    component_class: "FreeFree"
    params:
      polarizations: [True, False, False]
      longname: "Free-Free"
      shortname: "ff"
      smoothing_prior_FWHM: 30.0 # arcmin
      smoothing_prior_amplitude: 1.0e+9  # uK_RJ^2
      T: 7000
      nu0: 0.408 #40
      lmax: 512
      smoothing_scale: 0.0
      spatially_varying_MM: False
  
  RadioSources:
    enabled: False
    component_class: "RadioSources"
    params:
      polarizations: [True, False, False]
      longname: "RadioSources"
      shortname: "radsources"
      template_path: "/mn/stornext/d5/data/duncanwa/WMAP/data/init_radio_BP8.11.dat"
      nu_0: 30.0  # Ghz
      lmax: "full" #just a placeholder
      smoothing_scale: 0 # placeholder? Do we ever want a smoothing of point sources?
      sample_alphas: False
      
  SpinningDust:
    enabled: False
    component_class: "SpinningDust"
    params:
      polarizations: [True, False, False]
      longname: "SpinningDust"
      shortname: "sdust"
      template_path: "/mn/stornext/d5/data/duncanwa/WMAP/data/spdust2_cnm.dat"
      smoothing_prior_FWHM: 0.0 # arcmin
      smoothing_prior_amplitude: 1.0e+10  # uK_RJ^2
      nu_peak: 25.3  # Ghz
      nu_0: 22.0  # Ghz
      lmax: 1000
      smoothing_scale: 0 # 30.0
      spatially_varying_MM: False


compsep:
  dense_matrix_debug_mode: false  # Solve system first with dense matrix math, for debugging CG. Very slow for nside>32.
  preconditioner: JointPreconditioner #NoiseOnlyPreconditioner #FullPreconditioner #MixingMatrixPreconditioner #BeamOnlyPreconditioner #


CompSep_bands:
  ### TOD BANDS ###
  Planck30GHz:
    get_from: PlanckLFI
    enabled: true
    polarizations: [True, True, True]
  Planck44GHz:
    get_from: PlanckLFI
    enabled: false
    polarizations: [True, True, True]
  Planck70GHz:
    get_from: PlanckLFI
    enabled: false
    polarizations: [True, True, True]

  ### TOTAL INTENSITY MAPS ###
  Haslam408MHz:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "Haslam"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_n0512_60arcmin_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/haslam_rms_n0512_60arcmin_uK_1pct_0.8K.fits"
    fwhm: 60.0  # [arcmin]
    freq: 0.408 # [GHz]
    polarizations: [True, True, True]

  WMAPKa:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_030-WMAP_Ka_N_v4.fits"
    fwhm: 39.6 # [arcmin]
    freq: 33.0 # [GHz]
    polarizations: [True, True, True]

  WMAPQ1:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q1_N_v4.fits"
    fwhm: 30.6 # [arcmin]
    freq: 40.6 # [GHz]
    polarizations: [True, True, True]

  WMAPQ2:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q2_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_040-WMAP_Q2_N_v4.fits"
    fwhm: 30.6 # [arcmin]
    freq: 40.6 # [GHz]
    polarizations: [True, True, True]

  WMAPV1:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V1_N_v4.fits"
    fwhm: 21.0 # [arcmin]
    freq: 60.8 # [GHz]
    polarizations: [True, True, True]

  WMAPV2:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 512
    file_convention: "WMAP"
    path_signal_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V2_map_v4.fits"
    path_rms_map: "/mn/stornext/d5/data/duncanwa/WMAP/data/CG_060-WMAP_V2_N_v4.fits"
    fwhm: 21.0 # [arcmin]
    freq: 60.8 # [GHz]
    polarizations: [True, True, True]

  Planck857GHz:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 1024
    file_convention: "HFI"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_map_n1024_10arcmin_QUADCOR_ZODICOR_uK.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_857_rms_n1024_10arcmin_uK_hrscaled_true.fits"
    fwhm: 10 # [arcmin]
    freq: 857.0 # [GHz]
    polarizations: [True, False, False]

  ### POLARIZATION MAPS ###
  Planck353GHz:
    enabled: false
    get_from: "file"
    eval_nside: 256
    data_nside: 1024
    file_convention: "HFI"
    path_signal_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_353_map_n1024_uK_udgrade.fits"
    path_rms_map: "/mn/stornext/d16/cmbco/archive/bp/delivery/BP_releases/input/auxcmd3/npipe6v20_353_rms_n1024_hrscaled_uK_udgrade.fits"
    fwhm: 4.86 # [arcmin]
    freq: 353.0 # [GHz]
    polarizations: [False, True, True]


experiments:
  PlanckLFI:
    enabled: true
    is_sim: false
    pix_is_compressed: true
    psi_is_compressed: true
    data_type: "TOD"
    experiment_id: "planck"  # Decides expected data format, what TOD reader is used, etc.
    bad_PIDs_path: "/mn/stornext/d23/cmbco/jonas/c4_testing/Commander4/badPIDs.npy"
    Fourier_times_path: "/mn/stornext/d23/cmbco/jonas/c4_testing/analysis/FFT_times_0_399999.npy"
    num_scans: 45860
    bands:
      Planck30GHz:
        enabled: true
        tod_files_prefix: "LFI_030_"
        num_MPI_tasks: 128 #24
        detector_id: 0
        freq_identifier: 30
        eval_nside: 256
        data_nside: 512
        fwhm: 32.4 # [arcmin]
        freq: 28.4 # [GHz]
        fsamp: 32.5079365079365 # [Hz]
        data_path: "/mn/stornext/d16/cmbco/bp/mathew/test/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_030_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/bp/mathew/test/filelist_30.txt"
        detectors:
          27M:
            name: "27M"
            gain_est: 78.0e-9
            bandpass_shift: 0.28  # Ghz
          # 27S:
          #   name: "27S"
          #   gain_est: 65.5e-9
          #   bandpass_shift: 0.47
          # 28M:
          #   name: "28M"
          #   gain_est: 63.0e-9
          #   bandpass_shift: 0.08
          # 28S:
          #   name: "28S"
          #   gain_est: 52.0e-9
          #   bandpass_shift: 0.13
      Planck44GHz:
        enabled: false
        tod_files_prefix: "LFI_044_"
        num_MPI_tasks: 40
        freq_identifier: 44
        eval_nside: 256
        data_nside: 512
        fwhm: 27.1 # [arcmin]
        freq: 44.1 # [GHz]
        fsamp: 46.5454545454545
        data_path: "/mn/stornext/d16/cmbco/bp/mathew/test/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_044_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/bp/mathew/test/filelist_44.txt"
        detectors:
          24M:
            name: "24M"
            gain_est: 3.52e-9
            bandpass_shift: -0.55  # Ghz
          # 24S:
          #   name: "24S"
          #   gain_est: 5.60e-9
          #   bandpass_shift: 0.16
          25M:
            name: "25M"
            gain_est: 8.00e-9
            bandpass_shift: 0.28
          # 25S:
          #   name: "25S"
          #   gain_est: 7.95e-9
          #   bandpass_shift: 0.07
          # 26M:
          #   name: "26M"
          #   gain_est: 5.95e-9
          #   bandpass_shift: 0.09
          # 26S:
          #   name: "26S"
          #   gain_est: 6.90e-9
          #   bandpass_shift: -0.05
      Planck70GHz:
        enabled: false
        tod_files_prefix: "LFI_070_"
        num_MPI_tasks: 64
        freq_identifier: 70
        eval_nside: 512
        data_nside: 1024
        fwhm: 13.3 # [arcmin]
        freq: 70.1 # [GHz]
        fsamp: 78.7692307692308
        data_path: "/mn/stornext/d16/cmbco/bp/mathew/test/"
        processing_mask: "/mn/stornext/d5/data/duncanwa/WMAP/data/mask_proc_070_res_v5.fits"
        filelist: "/mn/stornext/d16/cmbco/bp/mathew/test/filelist_70.txt"
        detectors:
        detectors:
          18M:
            name: "18M"
            gain_est: 68.0e-9
            bandpass_shift: -0.87
          # 18S:
          #   name: "18S"
          #   gain_est: 45.0e-9
          #   bandpass_shift: 0.14
          # 19M:
          #   name: "19M"
          #   gain_est: 37.0e-9
          #   bandpass_shift: 0.73
          # 19S:
          #   name: "19S"
          #   gain_est: 24.0e-9
          #   bandpass_shift: 0.59
          # 20M:
          #   name: "20M"
          #   gain_est: 39.3e-9
          #   bandpass_shift: -0.27
          # 20S:
          #   name: "20S"
          #   gain_est: 33.2e-9
          #   bandpass_shift: 0.20
          # 21M:
          #   name: "21M"
          #   gain_est: 23.5e-9
          #   bandpass_shift: 0.06
          # 21S:
          #   name: "21S"
          #   gain_est: 24.0e-9
          #   bandpass_shift: -0.71
          # 22M:
          #   name: "22M"
          #   gain_est: 15.8e-9
          #   bandpass_shift: 0.36
          # 22S:
          #   name: "22S"
          #   gain_est: 16.2e-9
          #   bandpass_shift: -0.32
          23M:
            name: "23M"
            gain_est: 28.0e-9
            bandpass_shift: 0.13
          # 23S:
          #   name: "23S"
          #   gain_est: 19.0e-9
          #   bandpass_shift: -0.05